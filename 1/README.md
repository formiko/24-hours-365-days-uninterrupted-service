# 第1章 服务器基础设施搭建入门-冗余及负载分流的基础
## 1.1 冗余的基础
### 1.1.1 冗余概述
### 1.1.2 冗余的本质
1. 设想可能发生的故障
2. 预先准备好备份设备
3. 部署工作机制——当故障发生时，切换到备份设备
### 1.1.3 应对路由器故障的情况
冷备份：只有在故障发生时才需要连接到备份设备
### 1.1.4 应对Web服务器故障的情况
热备份：多台服务器同时运行，并保持同样状态的使用模式。
### 1.1.5 故障转移
* 故障转移：当现用设备发生故障时，系统会自动将处理交接到备份设备。
#### VIP
* VIP：虚拟IP地址（Virtual IP Address）
#### IP地址的映射
### 1.1.6 检测故障——健康检查
* 根据用途选择合适的方法：
    * ICMP监控（第三层）
        检查由ICMP所发出的echo请求是否得到了应答。由于这是最基本的健康检查，因此无法得知Web服务（Apache等）是否已经停止
    * 端口监控（第四层）
        通过使用TCP协议尝试连接主机，检查目标主机是否能被连接。该监控可以得知Web服务是否还在正常运行，但无从得知系统的负载情况，也无从得知错误的回报情况
    * 服务监控（第七层）
        通过实际发出HTTP请求等，检查该请求是否得到了应答。虽说这种方法可以检查所有的异常状况，但根据情况的不同，可能会加重目标主机的负载
* Web服务器的健康检查
    用的服务监控（第七层）
* 路由器的健康检查
    用的ICMP监控（第三层）
### 1.1.7 搭建Active/Backup的拓扑结构
### 1.1.8 还想更有效地使用服务器——负载分发
## 1.2 实现Web服务器的冗余——DNS轮询
### 1.2.1 DNS轮询
* DNS轮询是指：利用DNS把一台服务器需要处理的内容，分配到多台服务器来进行。
* DNS轮询存在以下问题：
    * 必须取得需要轮询的所有目标服务器的IP地址
    * 并不一定能实现均等的分发
        * 来自手机的访问会经由称为行业网关的代理服务器，代理服务器会将域名解析的结果缓存一段时间，所有经由代理服务器的访问请求就会被解析到同一台服务器上。
        * PC平台上的网页浏览器也会缓存DNS解析的结果。
        * 虽说将DNS记录的TTL（Time To Live，DNS记录的缓存时间）修改得短一些多少可以改善这个问题，但不能根本解决问题（困惑，为什么不能根本解决）
    * 无从得知服务器宕机
        即便服务器宕机，仍然继续进行负载分发处理
### 1.2.2 DNS轮询的冗余拓扑结构示例
### 1.2.3 还想更轻松地扩充系统——负载均衡器

